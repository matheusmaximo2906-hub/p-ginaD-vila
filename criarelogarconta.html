<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Sistema de Conta</title>
<style>
    body { font-family: Arial; background: #f0f0f0; padding: 20px; }
    .box { background: white; padding: 20px; width: 320px; border-radius: 10px; margin: auto; }
    input { width: 100%; padding: 10px; margin: 5px 0; }
    button { width: 100%; padding: 10px; cursor: pointer; }
    #perfil img { width: 120px; height: 120px; border-radius: 50%; object-fit: cover; }
</style>
</head>
<body>

<div class="box" id="cadastro">
    <h2>Criar Conta</h2>
    <input id="cadastroEmail" type="email" placeholder="Email">
    <input id="cadastroSenha" type="password" placeholder="Senha">
    <input id="cadastroNome" type="text" placeholder="Nome de Usu치rio">
    <button onclick="criarConta()">Criar Conta</button>
    <br><br>
    <a href="#" onclick="mostrarLogin()">J치 tem conta? Entrar</a>
</div>

<div class="box" id="login" style="display:none;">
    <h2>Login</h2>
    <input id="loginEmail" type="email" placeholder="Email">
    <input id="loginSenha" type="password" placeholder="Senha">
    <button onclick="fazerLogin()">Entrar</button>
    <br><br>
    <a href="#" onclick="mostrarCadastro()">Criar nova conta</a>
</div>

<div class="box" id="perfil" style="display:none;">
    <h2>Seu Perfil</h2>
    <img id="fotoPerfil" src="" alt="Foto de Perfil"><br><br>
    <strong id="nomeUsuario"></strong><br><br>

    <input type="file" id="uploadFoto">
    <button onclick="trocarFoto()">Trocar Foto</button><br><br>

    <button onclick="deslogar()">Sair</button>
</div>

<script type="module">

    // IMPORTS DO FIREBASE
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";

    import { 
        getAuth, 
        createUserWithEmailAndPassword, 
        signInWithEmailAndPassword, 
        onAuthStateChanged,
        signOut 
    } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";

    import { 
        getFirestore, 
        doc, 
        setDoc, 
        getDoc 
    } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js";

    import { 
        getStorage, 
        ref, 
        uploadBytes, 
        getDownloadURL 
    } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-storage.js";


    // 游댠 CONFIG DO SEU FIREBASE (COLOQUE AQUI)
    const firebaseConfig = {
        apiKey: "COLOQUE_AQUI",
        authDomain: "COLOQUE_AQUI",
        projectId: "COLOQUE_AQUI",
        storageBucket: "COLOQUE_AQUI",
        messagingSenderId: "COLOQUE_AQUI",
        appId: "COLOQUE_AQUI"
    };


    // INICIAR
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const storage = getStorage(app);


    // MOSTRAR LOGIN
    window.mostrarLogin = function () {
        cadastro.style.display = "none";
        login.style.display = "block";
    }

    // MOSTRAR CADASTRO
    window.mostrarCadastro = function () {
        login.style.display = "none";
        cadastro.style.display = "block";
    }


    // -----------------------------------------
    // CADASTRAR CONTA
    // -----------------------------------------
    window.criarConta = async function () {
        const email = cadastroEmail.value;
        const senha = cadastroSenha.value;
        const nome = cadastroNome.value;

        try {
            const userCred = await createUserWithEmailAndPassword(auth, email, senha);
            const uid = userCred.user.uid;

            await setDoc(doc(db, "usuarios", uid), {
                nome: nome,
                foto: "https://i.imgur.com/9QvqK5i.png" // foto padr칚o
            });

            alert("Conta criada com sucesso!");
        } catch (erro) {
            alert("Erro: " + erro.message);
        }
    }


    // -----------------------------------------
    // LOGIN
    // -----------------------------------------
    window.fazerLogin = async function () {
        const email = loginEmail.value;
        const senha = loginSenha.value;

        try {
            await signInWithEmailAndPassword(auth, email, senha);
        } catch (erro) {
            alert("Erro: " + erro.message);
        }
    }


    // -----------------------------------------
    // TROCAR FOTO
    // -----------------------------------------
    window.trocarFoto = async function () {
        const file = uploadFoto.files[0];
        if (!file) return alert("Selecione uma foto!");

        const user = auth.currentUser;
        const refFoto = ref(storage, "fotos/" + user.uid);

        await uploadBytes(refFoto, file);
        const url = await getDownloadURL(refFoto);

        await setDoc(doc(db, "usuarios", user.uid), { foto: url }, { merge: true });

        fotoPerfil.src = url;

        alert("Foto alterada!");
    }


    // -----------------------------------------
    // DESLOGAR
    // -----------------------------------------
    window.deslogar = function () {
        signOut(auth);
    }


    // -----------------------------------------
    // QUANDO O USU츼RIO LOGA
    // -----------------------------------------
    onAuthStateChanged(auth, async (user) => {
        if (user) {
            // est치 logado
            cadastro.style.display = "none";
            login.style.display = "none";
            perfil.style.display = "block";

            const dados = await getDoc(doc(db, "usuarios", user.uid));

            if (dados.exists()) {
                nomeUsuario.textContent = dados.data().nome;
                fotoPerfil.src = dados.data().foto;
            }

        } else {
            // n칚o est치 logado
            perfil.style.display = "none";
            login.style.display = "block";
        }
    });

</script>

</body>
</html>
